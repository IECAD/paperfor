# 논문 #20: *A Two-Phase UWB-Based Positioning Method for Indoor Non-Line-of-Sight Environments* (IEEE Sensors Journal, 2024)

## 1) 기본 정보
- **핵심 주제:** **범위(range)만 제공**하는 상용 UWB에서도 적용 가능한 **2단계(TPTP)** 위치추정.  
  ① **Coarse:** **MRwgh(Modified Residual Weighting)** 로 초기 위치 + **NLOS 식별/재구성**  
  ② **Refine:** **SMC(Particle Filter)** 안에 **SABO(Subtraction-Average-Based Optimization)** 를 결합한 샘플 최적화
- **환경/셋업:** 실내 사무/회의실/복도, **정지점 20개** GT(토탈스테이션), **stop-and-go** 수집

**3줄 요약**
1) **MRwgh**로 빠르고 견고한 초기치 산출 → **잔차 기반 NLOS 식별** 후 NLOS 범위를 **재구성**.  
2) **LOS/NLOS 공동 제약 영역**에서 prior 샘플을 생성하고, **SABO**로 샘플 분포를 전역해로 수렴시켜 정밀 추정.  
3) 결과: **RMSE ≈ 0.289 m**, **95% ≤ 0.4 m**, **1점 처리 0.377 s**. **LS, Rwgh, MRwgh, SIS, ALS(’22), RCSPF(’22)** 대비 **14–54%** 정확도 향상.

**핵심 기여(Contribution)**
- [x] **MRwgh**: 조합 폭발을 줄이고(예: 6센서 기준 **42→16**회) 잔차 역수의 **고차 가중**으로 NLOS 억제력↑  
- [x] **잔차-확률 기반 NLOS 식별** + **범위 재구성**(coarse 위치–앵커 거리)로 측정 벡터 정제  
- [x] **Joint-constraint sampling + SABO 갱신**을 SMC에 결합해 **샘플 빈곤/국소 최적** 문제 완화

---

## 2) 입력 데이터 (Input)
- **UWB 범위 d**(ToA/DS-TWR 계열), **앵커 좌표**  
- **NLOS 식별(개념):** coarse 추정 \(\hat{x}_{\text{MRwgh}}\) 기준으로 각 거리 \(d_i\)의 **LOS 하 누적확률**을 계산 → **임계 \(\lambda\)** 초과 시 NLOS로 판정  
- **NLOS 재구성:** \(d_i'=\|\hat{x}_{\text{MRwgh}}-(x_i,y_i)\|\) (표준편차는 보수적으로 2σ)

**우리 20D 입력과의 매핑**

| 우리 20D 특징 | 본 논문 처리 | 적용 아이디어 |
|---|---|---|
| DIST(ToF) | MRwgh → NLOS 식별·재구성 | 그대로 사용(좌표·단위 정합) |
| CIR/SNR/품질 | 비사용(범위만 가정) | **식별 확률·가중 보강**에 품질지표 곱(혼합모형/게이팅) |
| IMU/맵 | 비사용 | **동역학·가시성 제약**을 공동 제약 S에 추가 |

- **호환성 평가:** ✅ 매우 높음 — 프런트엔드(정제 범위) → 백엔드(SMC/UKF/FG)로 바로 삽입 가능

---

## 3) 모델 아키텍처 (Architecture)
- **Coarse 단계(MRwgh)**  
  1) 센서 크기 \(P\)별로 **정규화 잔차 최소 조합**만 채택  
  2) 각 최소조합 LS 해를 **잔차\(^{-n}\) (n≥2)** 가중 평균 → \(\hat{x}_{\text{MRwgh}}\)  
- **NLOS 식별/재구성**  
  - \(\Pr(D_i\le d_i\mid \text{LOS})\) 기반 가설검정(임계 \(\lambda\)) → NLOS는 \(d'_i\)로 교체(분산 2σ)  
- **Refine 단계(SMC+SABO)**  
  - **Joint constraint S:**  
    - NLOS: **원 중심 앵커, 반지름 = 측정거리** 내부  
    - LOS: **반지름 \(d_k+2\sigma_k\)** 내부  
    - \(S = S_{\text{NLOS}}\cap S_{\text{LOS}}\) 에서 prior 샘플 생성  
  - **SABO 갱신:** 샘플 간 **차-평균(subtraction–average)** 연산으로 **우수해역**으로 수렴(우도 기반 선택)  
  - **필요 시 리샘플**(유효 샘플 수 \(N_{\text{eff}}\) 기준)

**우리 모델과 비교**

| 구성 요소 | 논문(20) | 우리 파이프라인 | 시너지 |
|---|---|---|---|
| 프런트엔드 | **MRwgh+식별+재구성** | 품질/맵/NLOS 분류 | **하이브리드 정제**로 상호보완 |
| 샘플링 | **LOS/NLOS 공동 제약** | 가시성/맵 제약 일부 | 맵·가시성 추가로 S 강화 |
| 갱신 | **SABO in SMC** | UKF/FG/PF | **PF계열**에 즉시 이식 가능 |

---

## 4) 학습/하이퍼(Training)
- **딥러닝 없음.** 파라미터: **샘플수 \(N_p\)**, **SABO 반복 \(T\)**, **\(\lambda\)**(식별 임계), **\(N_{\text{thr}}\)**(리샘플 임계), 공정/측정 잡음  
- **권장 설정(실험 관찰):** \(N_p\approx 2000\), \(T=3\), \(\lambda\approx 0.9\), \(\sigma_d\approx 0.2\text{ m}\), 공정잡음 표준편차 \(\approx 0.2\text{ m/s}^2\)

---

## 5) 실험 및 결과 (Experiments)
- **셋업:** 실내 경로에 **정지점 20개**, 토탈스테이션 GT, 범위 데이터는 **거리 의존 오차**를 지수모델로 보정 후 사용  
- **비교군:** **LS**, **Rwgh**, **MRwgh**, **SIS**, **ALS(2022)**, **RCSPF(2022)**  
- **정확도:** **RMSE ≈ 0.289 m**, **95% ≤ 0.4 m**  
- **연산시간:** **~0.377 s/점**(i5-12500H, MATLAB) — 대부분 실시간 요건 충족  
- **식별 성능:** **LOS/NLOS 식별 정확도 ≈ 84.2%**(총 114회 판정)  
- **민감도/로버스트**  
  - **샘플수:** \(N_p\ge 2000\)에서 수렴, 더 늘려도 이득 미미  
  - **임계 \(\lambda\):** **0.89–0.91** 구간 최적  
  - **\(N_{\text{thr}}\):** 과도한 리샘플(=1.0)은 오히려 정확도↓(SABO 최적 분포 파괴)  
  - **SABO 반복:** **3회**면 충분(추가 반복은 이득↓, 시간↑)  
  - **센서 수 감소(4~5개):** 전 방법 악화되나 **TPTP가 여전히 최상** 유지

**핵심 수치 요약**

| 지표 | 값 |
|---|---|
| RMSE | ~**0.289 m** |
| 95% 오차 | **≤ 0.4 m** |
| 1점 처리시간 | **~0.377 s** |
| NLOS 식별 정확도 | **~84.2%** |
| 권장 \(N_p, T, \lambda\) | **2000, 3, ~0.9** |

---

## 6) 우리 연구와의 관계
- **즉시 적용 포인트**
  - [x] **MRwgh+식별+재구성**을 **표준 범위 정제 블록**으로 추가  
  - [x] **공동 제약 S**에 **가시성(레이캐스팅)/맵/안전구역**을 포함 → 샘플 분포 품질↑  
  - [x] **품질채널(CIR/SNR/NLOS score)** 을 **식별 확률/측정분산 스케일**에 곱해 **하이브리드** 구성  
  - [x] **PF 계열 백엔드**에서 **SABO 갱신** 옵션화(UKF/FG와 비교벤치)
- **기대효과:** **CIR 없이도** 강건한 성능 확보, CIR가 있을 땐 추가로 **식별/가중**을 더해 성능 상승

**벤치마킹 가치**  
- Related Work: ⭐⭐⭐⭐ / Baseline(범위-도메인 강건 위치추정): ⭐⭐⭐⭐⭐ / 구현 참고(MRwgh·SABO·제약샘플링): ⭐⭐⭐⭐⭐

---

## 7) 논문 작성 활용 메모
- **Related Work 문장 초안**  
  > “범위만 제공하는 상용 UWB를 대상으로 **MRwgh→잔차 기반 NLOS 식별·재구성**과 **공동 제약 샘플링+SABO**를 결합한 **2단계 TPTP**로 **RMSE≈0.29 m/95%≤0.4 m**를 달성했다.”
- **Methodology 차용 포인트**  
  1) **하이브리드 정제:** MRwgh + (우리 품질/맵 가중)  
  2) **PF-SABO 모듈화:** \(N_p\), \(T\), \(\lambda\), \(N_{\text{thr}}\) 자동 스윕 스크립트  
- **Figure/Table 아이디어**  
  - (Fig) **TPTP 파이프라인**(MRwgh→식별/재구성→Joint S→SMC+SABO)  
  - (Tbl) **LS/Rwgh/MRwgh/SIS/ALS/RCSPF/TPTP** RMSE·95%·시간 비교

---

## 8) 재현 팁
- **조합 축소:** MRwgh만으로도 초기치 품질↑ + 시간↓  
- **복도/비대칭 앵커:** 공동 제약에 **경계/가시성**을 추가(식별 신뢰↑)  
- **리샘플 빈도:** \(N_{\text{thr}}\)를 과대 설정하지 말 것(3회 SABO 이득 보존)  
- **라벨·CIR 없음 시** 기본 설정: \(N_p=2000, T=3, \lambda\approx 0.9\)

---

## 9) 구현 체크리스트
- [x] **MRwgh 모듈**(최소조합 선택, 고차 가중)  
- [x] **잔차-확률식별 + 재구성 API**(coarse 기반)  
- [x] **Joint-constraint 샘플러**(LOS/NLOS/맵/가시성 포함)  
- [x] **SABO 갱신기**(우도 기반 선택, \(N_{\text{eff}}\) 리샘플)  
- [ ] **하이브리드 ablation**(품질/맵/파라미터 스윕)  
- **우선순위:** 🟢
