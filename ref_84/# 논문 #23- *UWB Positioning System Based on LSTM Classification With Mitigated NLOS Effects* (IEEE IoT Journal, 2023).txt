# 논문 #23: *UWB Positioning System Based on LSTM Classification With Mitigated NLOS Effects* (IEEE IoT Journal, 2023)

## 1) 기본 정보
- **핵심 주제:** **CIR 시퀀스→LSTM**으로 **채널 상태를 10등분(오차 데사일 레이블)**로 분류하고, 분류 결과의 **평균 편향/분산(μ̂, σ̂²)**을 이용해 **거리 보정(Ẑ)**·**측정공분산(R̂)**을 구성하여 **EKF**에 주입하는 **AI-EKF** 프레임워크
- **하드웨어/셋업:** 태그(DWM1000 + NXP LPC1768 + FT232H), 앵커(DWM1001-DEV) 5개, **DS-TWR+**(범위·CIR 동시획득), **Ts=200 ms**, DS-TWR+ 25 ms, PRF 16 MHz, 110 kb/s, ch=3, BW=499.2 MHz, preamble 1024
- **키워드:** LSTM, **데사일 라벨링(10-class)**, **NLOS 편향 보정**, EKF

**3줄 요약**
1) **CIR(497–992 ns 구간)**을 입력으로 **LSTM**이 **TWR 오차 데사일(D1…D10)**을 예측.  
2) 클래스별 통계로 **Ẑ = Z − μ̂_l**, **R̂ = diag(σ̂²_l)**를 만들어 **EKF 보정 단계**에 투입.  
3) **KNOWN/UNKNOWN**(미학습 장소) 모두에서 **EKF 대비 RMSE ~50%↓, STD ~64%↓**, 분류 정확도 **~81.7%**.

**핵심 기여(Contribution)**
- [x] **이진(LOS/NLOS) 대신 10-클래스 오차 등급**을 학습해 **환경 변화 일반화**  
- [x] **거리 편향(μ̂)** 보정 + **R̂ 동적화**로 EKF의 **NLOS 민감도**를 구조적으로 감소  
- [x] **DS-TWR+**로 **범위·CIR 동시 수집**(스케줄 방해 최소화) 실장

---

## 2) 입력 데이터 (Input)
- **원본 입력:** DS-TWR+로 얻은 **범위 d**와 해당 프레임의 **CIR 파형**  
- **학습/추론 입력:** **CIRraw 496샘플(497–992 ns)**  
- **라벨링:** **TWR 오차의 데사일(D1…D10)** — 오차가 **지수분포**를 따른다는 가정 하 **상위 등급일수록 편향↑**

**우리 20D 입력과의 매핑**

| 우리 20D 특징 | 논문 특징 | 적용 아이디어 |
|---|---|---|
| CIR 원파형 | LSTM 입력 | 기존 **CIR/SNR/FPD** 채널을 **다채널 입력**으로 결합 |
| NLOS score | 10-class 확률 p(l) | **E[μ], E[σ²]**로 변환해 **Rₜ 스케일·잔차 게이팅**에 연동 |
| Range | Ẑ = Z−μ̂_l | **품질·맵 prior**와 합쳐 **μ̂_l 보정치**를 적응 가중 |

- **호환성 평가:** ✅ 매우 높음 — 프런트엔드 품질/보정 블록으로 즉시 삽입 가능

---

## 3) 모델 아키텍처 (Architecture)
- **파이프라인:** **[DS-TWR+] → [CIR→LSTM(10-class)] → [NLOS 완화: Ẑ, R̂ 생성] → [EKF(6상태: x,y,vx,vy,ax,ay)] → 위치**
- **핵심 수식(보정):**  
  \( Ẑ_k = Z_k - b_k,\; b_k = [\mû_{l,0},\dots,\mû_{l,n}]^\top \)  
  \( R̂_k = \mathrm{diag}(\sigmâ^2_{l,0},\dots,\sigmâ^2_{l,n}) \)  
  (l은 LSTM이 예측한 오차 등급; 앵커별 통계 사용)

**우리 모델과 비교**

| 구성 요소 | 본 논문 | 우리 파이프라인 | 시너지 |
|---|---|---|---|
| NLOS 처리 | **데사일 분류 + 통계 보정** | 퍼지/DPGMM/품질가중 | **앙상블**로 오탐/미탐↓ |
| 백엔드 | EKF | EKF/UKF/FG/PF | **Ẑ,R̂** 생성부만 공통화하여 재사용 |
| 수집 | DS-TWR+ | TWR/TDOA 혼용 | TDOA에도 **R 스케일링** 개념 이식 |

---

## 4) 학습 방법 (Training)
- **데이터셋:** 연구동 **랩/복도/홀/오피스** 4구역, 각 지점 **DS-TWR+ 500(무간섭)+500(인간 간섭)** 측정, **3σ** 아웃라이어 제거
- **라벨 분할:** **Train/Val/Test = 80/10/10%** (데사일 균등)
- **모델 선택:** 다양한 LSTM/GRU/CNN 비교 후 **LSTM(raw CIR)** 채택(정확도/효율 균형)  
- **학습 설정:** Adam, **lr=1e-3**, cross-entropy, 드롭아웃 0.2

---

## 5) 실험 및 결과 (Experiments)
- **분류 성능:** **정확도 ≈ 81.7%**(혼동은 인접 등급에서 주로 발생)  
- **시나리오 KNOWN(학습장소):**  
  - WLS vs LS: **RMSE −14.4%**, **STD −35.6%**  
  - EKF: STD는 좋으나 RMSE는 **WLS 대비 −6.2%p** 개선 한계  
  - **AI-EKF:** EKF 대비 **RMSE −48.3%**, **STD −43%** (궤적 흔들림 완화)  
- **시나리오 UNKNOWN(미학습 장소):**  
  - **AI-EKF:** EKF 대비 **RMSE −50%**, **STD −63.9%**  
- **운영 파라미터:** 앵커·태그 높이 **1.5 m**, **5 앵커**, **Ts=200 ms**

---

## 6) 우리 연구와의 관계
- **즉시 적용 포인트**
  - [x] **LSTM 데사일 분류기**를 품질모듈로 삽입 → **E[μ],E[σ²]** 산출 API → **Ẑ,Rₜ**로 연결  
  - [x] **품질채널(CIR/SNR/FPD/가시성)**을 입력 확장 → **일반화·강건성↑**  
  - [x] **DPGMM(#16), Fuzzy-DT(#19)**와 **스태킹/캘리브레이션**(Platt/Isotonic)으로 앙상블
- **기대효과:** **환경 전이(UNKNOWN)**에서 재학습 없이 **잔차 폭주 억제**, 추적 안정성↑

**벤치마킹 가치**  
- Related Work: ⭐⭐⭐⭐ / Baseline(NLOS 완화+EKF 라인): ⭐⭐⭐⭐⭐ / 구현 참고(데사일-통계 보정): ⭐⭐⭐⭐⭐

---

## 7) 논문 작성 활용 메모
- **Related Work 문장 초안**  
  > “CIR 기반 **LSTM 10-class**로 채널오차를 분류하고, **통계적 보정(Ẑ,R̂)**을 EKF에 결합한 **AI-EKF**가 **미학습 장소**에서도 EKF 대비 **RMSE/STD ~50/64%** 개선을 보였다.”
- **Methodology 참고 포인트:** DS-TWR+ 수집, 데사일 라벨링, **Ẑ,R̂** 생성 인터페이스
- **Experiments 비교 계획:** LS/WLS/EKF vs **AI-EKF** (KNOWN/UNKNOWN, P80/P95 포함)
- **Figure/Table 아이디어:** (Fig) 파이프라인/혼동행렬, (Tbl) KNOWN/UNKNOWN **RMSE/STD/P95**

---

## 8) 재현 팁
- **CIR 윈도우**(497–992 ns)·전처리(정규화) 고정, **3σ** 아웃라이어 컷  
- 클래스별 **μ̂, σ̂²**는 **앵커별/환경무관** 통계로 유지 → 전이성↑  
- **R̂**가 너무 작아지지 않도록 **하한(εI)** 추가(필터 발산 방지)

---

## 9) 구현 체크리스트
- [x] **DS-TWR+ 수집기**(범위·CIR 동시)  
- [x] **LSTM 분류기**(10-class, 입력 다채널화 옵션)  
- [x] **Ẑ,R̂ 생성 API**(클래스 확률→E[μ],E[σ²])  
- [x] **EKF 어댑터**(상태 6, H/Jacobian)  
- [ ] **앙상블**(DPGMM/Fuzzy-DT 결합) + **도메인 적응**(BN-adapt)
sification_With_Mitigated_NLOS_Effects.pdf](sediment://file_00000000baa461fa974881019ef7efa7)