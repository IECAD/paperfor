# 논문 #21: *A Dynamic Window-Based UWB-Odometer Fusion Approach for Indoor Positioning* (IEEE Sensors Journal, 2023)

## 1) 기본 정보
- **핵심 주제:** **단일 UWB 앵커 + 오도메터**만으로 전역 위치추정을 수행하는 **DWBPF(동적 윈도우 기반 PF)** 제안. **DW1000 전력 품질지표 Q̃**로 윈도우 반경과 예측/관측 가중을 **적응**시켜 누적오차·NLOS에 강건.  
- **환경/셋업:** 실내 오픈 구역, 로봇 주행(직사형 3×2 m 랩 경로), 앵커 높이 2 m, 표본점 8개 반복(총 56 샘플) + **슬립 유발 재시작 실험**.
  
**3줄 요약**
1) **초기화:** 오도메터 고정밀 단기 추적을 이용, **3개 샘플점**과 **삼변측량+LS**로 **앵커 상대좌표**→로봇 초기 좌표 추정(평균오차 **≈0.17 m**).  
2) **추정:** **동적 원형 윈도우**(반경 r=Q̃ 기반) 안에 파티클을 **직접 분포**시켜 수렴/유실 문제 완화, **예측/거리/각도 점수**를 Q̃로 **가중**.  
3) **성능:** 평균오차 **0.061 m**(최대 **0.125 m**)로, 오도메터(0.132 m)·전통 PF(0.086 m) 대비 개선. 슬립 후 **자율 재시작**으로 연속 추적 복구.

**핵심 기여(Contribution)**
- [x] **단일 앵커** + **오도메터** 조합으로 **저비용 전역 위치**  
- [x] **Q̃(수신전력–첫경로전력 차)** 기반 **적응 윈도우/가중**(LOS<6 dBm, NLOS>10 dBm 기준)  
- [x] **재시작 규칙**(측정 반경 vs 동적 윈도우 편차)로 **track-loss 자동 복구**

---

## 2) 입력 데이터 (Input)
- **UWB 범위** \(s\) → **수평거리** \(d = \sqrt{s^2-(z_a-h)^2}\)  
- **오도메터 증분** \(\Delta x,\Delta y,\Delta \theta\) (차륜 인코더 → 차동구동 모델)  
- **품질 지표 \(Q̃\)**: CIR 기반 **Rx\_Power vs FP\_Power** 차이(dBm). **Q̃<6**≈LOS, **Q̃>10**≈NLOS.

**우리 20D 입력과의 매핑**

| 우리 20D 특징 | 논문 특징 | 변환/활용 |
|---|---|---|
| DIST(ToF) | 수평거리 d | 동일 사용 |
| CIR/SNR 품질 | Q̃ 사용 | **품질채널**로 통합(추가 지표와 결합) |
| IMU/오도메터 | 오도메터 | 우리 IMU/휠 오도 통합 prior로 대체/강화 |

- **호환성:** ✅ 높음 — 프런트엔드 품질가중 + PF 백엔드 구조와 잘 맞음.

---

## 3) 모델 아키텍처 (Architecture)
- **초기 위치 추정:**  
  - 조건: 초기 자세 \(\theta\) 알려짐.  
  - **Q̃<6 dBm**인 프레임 위주로 **3 샘플점** 선택 → **LS**로 **로봇↔앵커 상대좌표** 추정 → 좌표변환.
- **DWBPF 추정 루프:**  
  1) **예측 중심** \(o = \hat{x}_{t-1} + \Delta\) (오도메터)  
  2) **윈도우 반경** \(r=f(Q̃)\): LOS/NLOS 구간별 **piecewise**(Q̃↑ ⇒ 관측 불신, 예측 신뢰↑)  
  3) **재시작 판정:** 측정반경 vs 윈도우 편차가 임계 초과 시 **PF 재시작**  
  4) **파티클 배치:** 원반 \(r\) 내 **균일 분포**(재샘플 대신 직접 분포 → 수렴 문제 완화)  
  5) **스코어링:**  
     - 예측근접(pre), **거리오차(dis)**, **각도오차(deg)**  
     - **가중 행렬 Z=[Q̃,\, 6²/Q̃]**로 **예측:관측 비중**을 Q̃로 적응  
  6) **출력:** 상위 **5% 파티클 평균**을 \(\hat{x}_t\)로 채택.

**우리 모델과 비교**

| 구성 요소 | 본 논문 | 우리 파이프라인 | 차이/시너지 |
|---|---|---|---|
| 품질가중 | Q̃ 단일 | CIR/SNR/FPD/NLOS score 다채널 | **멀티채널 Q̃\***로 확장 |
| 백엔드 | PF(DWBPF) | PF/UKF/FG 혼용 | **분산/가중 정책**만 공통화해 재사용 |
| 재시작 | 윈도우-반경 규칙 | 게이팅/Neff 기반 | 병렬 사용 가능(강건성↑) |

---

## 4) 학습/설정 (Training)
- **비학습형** 규칙기반 PF.  
- **오차모델 파라미터 예:** LOS \( \mu=0.1\), \(\sigma=0.055\); NLOS 감마 \(k=2, \lambda=3.5\).  
- **하이퍼:** 파티클 수 \(N\), 상위 비율(기본 5%), 재시작 임계, Q̃ 경계(6/10 dBm).

---

## 5) 실험 및 결과 (Experiments)
- **정지 거리 정확도:** 평균 **0.026 m**, 최대 **0.082 m**.  
- **추적(70 m, 56 샘플):**  
  - **오도메터:** 평균 **0.132 m**, 최대 **0.298 m**  
  - **기본 PF:** 평균 **0.086 m**, 최대 **0.189 m**  
  - **DWBPF:** **평균 0.061 m**, **최대 0.125 m**  
- **재시작 실험(슬립 유발):** 재시작 직후 좌표오차 **≈0.13 m**로 초기화 수준 회복, 이후 정상 추적.

---

## 6) 우리 연구와의 관계
- **즉시 적용 포인트**
  - [x] **Q̃→멀티채널 품질지표**로 대체: \(Q̃^\* = g(\text{CIR/SNR/FPD/맵가시성})\)  
  - [x] **동적 윈도우 반경/가중** 공식을 **PF/UKF/FG** 공통 유틸로 이식  
  - [x] **재시작 규칙**을 현행 **게이팅/Neff/잔차감시**와 **AND/OR** 결합
- **기대효과:** 단일 앵커/희소 앵커 환경에서 **추적 연속성↑**, NLOS·슬립·급기동에 **강건**.

**벤치마킹 가치**  
- Related Work: ⭐⭐⭐  
- Baseline(저비용 단일 앵커 융합): ⭐⭐⭐⭐⭐  
- 구현 참고(Q̃ 기반 적응 윈도우/가중, 재시작): ⭐⭐⭐⭐⭐

---

## 7) 논문 작성 활용 메모
- **Related Work 한 줄**  
  > “단일 앵커 UWB와 오도메터를 **동적 윈도우 PF**로 융합, **Q̃ 적응**으로 LOS/NLOS·슬립 상황에서도 **평균 6 cm**급을 달성했다.”
- **Methodology 차용**  
  1) **품질 적응 윈도우+가중**을 공통 백엔드에 모듈화  
  2) **재시작 트리거**를 **맵 가시성/잔차 히스토그램**과 결합
- **Figure/Table 아이디어**: (Fig) **윈도우 반경 r(Q̃)** 곡선 & 재시작 시점; (Tbl) Odom vs PF vs DWBPF **평균/최대** 비교

---

## 8) 재현 팁
- 초기 자세 \(\theta\) 추정 오차가 크면 **3점 선택 규칙(Q̃<6, 비공선)**을 더 보수적으로.  
- NLOS 빈발 환경은 **상위비율(5%→3%)**로 더 날카롭게.  
- 멀티앵커 확장 시 **윈도우는 앵커별 교집합**으로 축소(속도↑·정확도↑).

---

## 9) 구현 체크리스트
- [x] **Q̃ 추출기**(DW1000 CIR → Rx/FP 파워)  
- [x] **r(Q̃)·Z(Q̃) 유틸**(반경/가중 자동화)  
- [x] **DWBPF 루프**(직접 분포, 상위 5% 평균)  
- [x] **재시작 규칙**(반경-편차) + **게이팅/Neff** 결합 옵션  
- [ ] **멀티채널 Q̃\*** 실험(CIR/SNR/FPD/맵 포함 Ablation)  
- **우선순위:** 🟢
