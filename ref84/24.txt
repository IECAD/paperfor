# 논문 #24: *A Seamless Pedestrian Localization System Based on GNSS/IMU/UWB/MAP Integration* (IEEE IoT Journal, **2025** · Accepted)

## 1) 기본 정보
- **핵심 주제:** 스마트폰 **GNSS/IMU**와 **UWB**, **3D MAP**을 **팩터그래프(FO)**로 결합한 **보행자 실내·외 시밍리스 위치**.  
  - GNSS: **3D-NLOS Discrimination Line(3D-NLOS-DL)**로 NLOS 제거 + **3-Step GNSS**  
  - UWB: **SWPDOP** 기반 **앵커 최적 배치(경사하강)** + **TSML(2-step ML)** 위치  
  - MAP: **충돌/고도 제약** + **조건부 비정상 마코프** **경로 예측**  
  - 후처리: **Joint Filter(스파이크 검출 + 저역통과)**
- **하드웨어/셋업:** 스마트폰 **HONOR V20**, **iQOO U3**; UWB **Nooploop LinkTrack P-A**; 다양한 실외/전이/실내 경로.

**3줄 요약**
1) GNSS는 **3D-NLOS-DL**과 **시계열 이상치 필터**를 묶은 **3-Step**으로 정확도·안정성 업.  
2) UWB는 **SWPDOP 앵커배치 + NLOS 판별(RSSI_tr−RSSI_fp, 구역 불일치)** + **TSML**로 정밀도 확보.  
3) **FO 기반 품질가중 융합 + MAP 제약/예측 + Joint Filter**로 **실외/전이/실내** 전 구간에서 기존 융합 대비 **오차·분산 대폭 감소**.

**핵심 기여(Contribution)**
- [x] **3D-NLOS-DL**: 지형/수목/건물 포함 3D맵으로 **위성 LOS/NLOS 신속 판별**  
- [x] **SWPDOP + 경사하강**: 공간 가중을 반영한 **앵커 최적 배치** 방법  
- [x] **MAP 제약·경로 예측**: **조건부 비정상 마코프**로 **경로 예측→현재 위치 보정**  
- [x] **Joint Filter**: 스파이크/계단형 이상을 정정하고 연속성↑

---

## 2) 입력 데이터 (Input)
- **GNSS:** 의사거리(위성 수, 고각/방위), 3D-NLOS-DL 기반 NLOS 제거  
- **UWB(TOA/TWR):** 범위 + (가용 시) 앵커 구역 정보; **NLOS 규칙**  
  - \(E_1\): **RSSI\_{tr} − RSSI\_{fp} > \text{limit}_5\)** → NLOS  
  - \(E_2\): **앵커 구역 ≠ 현재 태그 구역** → NLOS  
- **IMU:** 가속/각속 → **INS/PDR**  
- **MAP(3D):** 충돌/고도 제약, 상태전이 확률(마코프)  
- **품질지표:** 위성/앵커 개수, 분산, MAP 오차, 시간차이를 함수화한 **품질가중 \(\alpha_G,\alpha_U,\alpha_{INS},\alpha_{PDR}\)**

**우리 20D 입력과의 매핑**

| 우리 20D 특징 | 본 논문 특징 | 적용 아이디어 |
|---|---|---|
| DIST(ToF), NLOS score | TSML, NLOS 규칙(E1/E2) | 규칙 + **학습형 NLOS**(FDT/LSTM/DPGMM) **하이브리드** |
| IMU/오도메트리 | INS/PDR | **상태모델 보강**(ZUPT/컨스트레인트) |
| MAP/가시성 | 충돌/고도 제약 + 경로예측 | **레이캐스팅 가시성**·금지구역을 제약에 추가 |
| 품질가중 | \(\alpha\) 정규화 | 우리 **동적 R/Q 스케일러**에 직접 연동 |

- **호환성:** ✅ 높음 — 프런트엔드(NLOS 필터·TSML·품질가중)와 백엔드(FO/FG, PF/UKF) 모두에 모듈로 삽입 가능.

---

## 3) 모델 아키텍처 (Architecture)
- **계층 구조:** 하드웨어 → 데이터(프리필터) → 알고리즘(INS/PDR, GNSS-3Step, UWB-TSML, MAP 제약/예측, **품질가중 융합**) → 앱 계층  
- **팩터그래프(FO):** GNSS 의사거리, UWB 측정, INS, PDR, **MAP 제약/예측**, **품질가중**을 **상태노드**에 연결해 시계열 최적화  
- **GNSS 3-Step:** 초기해 → **NLOS 제거(3D-NLOS-DL + 위성 제한)** → **스파이크 시계열 필터**  
- **UWB 위치:** **TSML (≥4 앵커)**; 4 미만 시 보완식(3→2D+z평균, 2→평균, 1→그 앵커 좌표)  
- **SWPDOP 배치:** 공간가중 \(g(P)\) 반영, **단일좌표 갱신 경사하강**으로 빠르게 수렴  
- **MAP 제약/예측:** 충돌보정 \(V_{res}\), 고도함수 \(f_{MAP}\); **조건부 비정상 마코프**로 k-step 경로예측→보정  
- **Joint Filter:** 스파이크 검출 + 구간 보간 + 저역통과

**우리 모델과 비교**

| 구성 요소 | 본 논문 | 우리 파이프라인 | 시너지 |
|---|---|---|---|
| GNSS NLOS | 3D-NLOS-DL | 단순 마스크/맵 | **가시성+지형 포함 DL**로 업그레이드 |
| UWB 해법 | TSML | EKF/UKF/FG/PF | **TSML을 프런트엔드**로 붙이고 후단 필터와 병행 |
| 품질융합 | \(\alpha\) 정규화 | 동적 R/Q | **공통 스케일러**로 통합 |
| MAP | 충돌/고도+마코프 | 레이캐스팅/금지구역 | 양방향 이식(제약·예측) |

---

## 4) 학습·하이퍼(Training)
- **비학습형 중심**(규칙·최적화·필터).  
- 주요 파라미터: GNSS 위성 제한값(limit₁≥4), 이동 임계(limit₂), UWB NLOS 임계(limit₅), SWPDOP 반복 횟수·스텝, Joint Filter 임계(limit₆, limit₇) 등.

---

## 5) 실험 및 결과 (Experiments)
- **환경:** 야외(지형/수목/건물), 전이(입·출입), 실내(복도/계단/승강기). UWB 앵커 수 **최대 9**(일부 NLOS).  
- **비교 알고리즘:** GPS-UWB-INS-EKF, GPS-UWB-PDR-CV, …-SMM, **Fusion-Map(제안)**, **Fusion-Map-JF(제안)**  
- **핵심 성능(제안 Fusion-Map-JF 기준):**
  - **Outdoor:** **RMSE 10.83 m(Honor) / 10.77 m(iQOO)**, **STD 4.80/5.50 m** → **기존 CV-SMM 대비 44.4% / 40.0% 개선**  
  - **Transition:** **RMSE 10.77/4.76 m**, **STD 2.54/1.92 m** → **+4.61% / +19.6%**  
  - **Indoor:** **RMSE 3.79/3.91 m**, **STD 1.76/1.87 m** → **+8.00% / +5.78%**  
- **관찰:** 실외에서 **MAP 보정 효과**가 특히 큼(기저오차↑), 전이/실내는 UWB 가용성으로 상대 개선폭↓. CDF에서도 제안법이 가장 가파름(분산 억제).

---

## 6) 우리 연구와의 관계
- **즉시 적용 포인트**
  1) **3D-NLOS-DL**을 GNSS 가시성·지형 포함 **가시성 엔진**으로 이식  
  2) **SWPDOP 배치기**로 앵커 레이아웃 자동 최적화(복도/홀/계단 가중)  
  3) **TSML 프런트엔드 + 동적 R/Q** 결합 → 후단 EKF/UKF/FG/PF와 병행  
  4) **MAP 제약/경로 예측**을 현행 20D 파이프라인에 플러그인  
  5) **Joint Filter**를 최종 궤적 스무딩 표준 단계로 채택
- **예상 효과:** 야외/전이 구간 **급락 오차** 억제, 실내에서도 **충돌·고도 제약**으로 드리프트 감소

**벤치마킹 가치**  
- Related Work: ⭐⭐⭐⭐  
- Baseline(시밍리스 융합 라인): ⭐⭐⭐⭐⭐  
- 구현 참고(앵커배치·GNSS NLOS·MAP 예측·Joint Filter): ⭐⭐⭐⭐⭐

---

## 7) 논문 작성 활용 메모
- **Related Work 한 줄**  
  > “GNSS/IMU/UWB/MAP을 **팩터그래프**로 통합하고 **3D-NLOS-DL**, **SWPDOP 배치**, **MAP 제약·경로 예측**, **Joint Filter**로 보행자 **시밍리스 위치**를 달성했다.”
- **Methodology 차용**: GNSS-3Step, TSML 프런트엔드, 품질가중 \(\alpha\), MAP 제약/예측(마코프)  
- **Experiments 비교 계획**: (실외/전이/실내) **EKF / PDR-CV / PDR-CV-SMM / 제안**의 **RMSE·STD·CDF**  
- **Figure/Table 아이디어**: 3D-NLOS-DL 도식, SWPDOP 배치 전/후, MAP 제약 전/후 궤적, CDF 비교

---

## 8) 재현 팁
- **3D MAP**은 간단한 **지상고도함수 + 충돌체**만으로도 효과적(정밀 LiDAR 없을 때 대체)  
- UWB 앵커는 **SWPDOP 가중**으로 배치(복도/계단/전이 구역 중요도↑)  
- **Joint Filter 임계**는 환경별 튜닝(스파이크 폭·밀도 기준)

---

## 9) 구현 체크리스트
- [x] **3D-NLOS-DL**(위성 궤도·지형·건물)  
- [x] **SWPDOP 배치기**(경사하강, 공간가중)  
- [x] **UWB TSML**(+<4 앵커 보완 루틴)  
- [x] **품질가중 \(\alpha\)** → **R/Q 스케일러** 연동  
- [x] **MAP 제약/경로 예측(마코프)**  
- [x] **Joint Filter**(스파이크+LPF)  
- **우선순위:** 🟢 (시밍리스 시나리오 대비 가치 큼)
