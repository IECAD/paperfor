# 논문 #22: *UWB Localization Based on Dual-Channel Neural Network and Total Least Square (TLS) Method* (IEEE Sensors Journal, 2024)

## 1) 기본 정보
- **주제:** UWB **CIR**에서 **LOS/NLOS 이진 분류**를 **이중채널 딥러닝(CNN-TCN-Attention + CGWT-CNN)** 으로 수행하고, 분류 결과로 **거리 보정** 후 **TLS**로 최종 위치추정.
- **환경/셋업:** 공개 **eWINE** 데이터 + 자체 4개 실내 시나리오(랩/오피스/복도/강의실), 실제 랩에서 **3 앵커**로 2D 위치 실험.

**3줄 요약**
1) **채널1:** 1D **CIR → CNN → TCN(6층) → Self-Attention**. **채널2:** **CGWT**로 **시간-주파수 이미지(42×42×3)** → **2D CNN**.  
2) 두 채널 출력을 합쳐 **LOS/NLOS 분류 정확도**: 공개세트 **89.24%**, 로컬 4환경 **95.33/87.50/98.83/97.83%**, **Mixed 90.49%**.  
3) 실제 랩 데이터에서 **NLOS 거리편향(실제의 1.4–1.6배)**을 통계보정 후 **TLS** 적용 → 평균 오차 **X: 1090→404 mm**, **Y: 645→239 mm**로 감소.

**핵심 기여**
- [x] **시간영역+시주파영역**을 병렬 처리하는 **이중채널** 구조로 분류 성능 및 런타임(≈**0.5 ms/샘플**) 확보  
- [x] 분류 결과를 이용한 **간이 NLOS 거리 보정 → TLS 위치추정**까지 **엔드-투-엔드 파이프라인** 실증  
- [x] **아블레이션**(채널별/레이어수/데이터크기)로 구조 선택 근거 제시

---

## 2) 입력 데이터 (Input)
- **CIR 윈도우:** 원시에서 **650–906 ns** 구간만 사용  
- **채널1 입력:** 1D CIR 시퀀스  
- **채널2 입력:** **CGWT**로 변환한 시간-주파수 이미지 **42×42×3**

**우리 20D 입력과의 매핑**

| 우리 20D 특징 | 논문 입력/처리 | 활용 아이디어 |
|---|---|---|
| CIR 원파형/요약 | 1D CIR + CGWT 이미지 | **CIR+품질(SNR/FPD)** 동시 투입, 데이터 증강 |
| NLOS score | DL 분류 확률 | **소프트 가중**(Rₜ 스케일) 및 **잔차 게이팅 prior** |
| Range | 분류 기반 보정 후 TLS | 보정치를 **학습 회귀(모델화)**로 대체/강화 |

- **호환성 평가:** ✅ 높음 — 프런트엔드 **NLOS 분류/보정 블록**으로 즉시 삽입 가능.

---

## 3) 모델 아키텍처 (Architecture)
- **채널1: CNN-TCN-Attention**  
  - CNN: 1×3 커널 64/64/128, 마지막 stride=2, ReLU+**MaxPool(1×2)**  
  - **TCN 6층**(1D causal+dilated conv, 1×3, 64필터)  
  - **Self-Attention**으로 문맥 관계 보강
- **채널2: CGWT-CNN**  
  - **CGWT**(복소 가우시안 기반 CWT) → 42×42×3  
  - CNN: 3×3, 32→64, 각 **MaxPool 2×2**, **Dense 128→8**, Dropout
- **결합:** 두 채널 출력 **concatenate** → **LOS/NLOS** 확률  
- **위치추정:** NLOS로 분류된 거리 **통계보정** 후 **TLS**(**앵커/거리 오차** 동시 고려)

**우리 모델과 비교**

| 구성 | 논문(22) | 우리 파이프라인 | 차이/시너지 |
|---|---|---|---|
| NLOS 처리 | 이중채널 DL 분류 | 퍼지/DPGMM/품질가중 | **하이브리드 앙상블**로 오탐/미탐↓ |
| 거리 보정 | 규칙 기반(1.4–1.6배 역보정) | 회귀/물리/맵 가중 | **학습형 보정**으로 일반화↑ |
| 백엔드 | TLS | EKF/UKF/FG/PF | TLS↔필터 **교체/병행** 가능 |

---

## 4) 학습/설정
- **학습:** Epoch **50**, Batch **32**, **Nadam**, **binary_crossentropy**, 초기 **lr=1e-3**, **plateau 3 step** 미개선 시 ×0.1
- **라벨:** one-hot(LOS/NLOS)
- **런타임:** 병렬구조 + 시퀀스 절단 덕분에 **≈0.5 ms/샘플**

---

## 5) 실험 및 결과
- **데이터 구성:**  
  - 공개(eWINE) 7장소 각 LOS/NLOS 3000 → **훈 70%/검 30%**(랜덤 5000 샘플/장소 사용)  
  - **로컬 4환경**(랩/오피스/복도/강의실) 각 6000(LOS/NLOS 절반)  
  - **Mixed 15,000**(공개×7: 각 1000 + 로컬×4: 각 2000)
- **분류 성능:** 공개 **89.24%**, 로컬 **95.33/87.50/98.83/97.83%**, Mixed **90.49%**  
- **아블레이션:** 채널1 **Conv=3, TCN=6**가 최적(과다층 → 과적합); 채널2 **Conv=2** 최적; **데이터↑ → 정확도↑**  
- **포지셔닝:** 랩 실험(앵커 3개, z=0.5 m 고정)에서 **NLOS 통계보정+TLS**로 **X/Y 평균오차 404/239 mm**  
- **일반화:** 도메인 전이 성능 저하(랩→복도 적용 시 **67.76%**) → **장소-별 학습 권장**

---

## 6) 우리 연구와의 관계
- **즉시 적용 포인트**
  - [x] **이중채널 분류기**를 품질모듈로 삽입 → **Rₜ 동적화**(확률 가중), 게이팅 prior  
  - [x] **거리 보정**을 규칙이 아닌 **학습 회귀(예: QR/EMOS/NN)**로 치환(환경 일반화)  
  - [x] **TLS↔EKF/UKF/FG** 비교벤치(앵커 오차/측정 잡음 공존 케이스)
- **예상 효과:** **NLOS 판별↑ → 잔차 폭주↓**, **경량 TLS**로 코드 이식 쉬움

**벤치마킹 가치**  
- Related Work: ⭐⭐⭐⭐ / Baseline(NLOS 분류 라인): ⭐⭐⭐⭐⭐ / 구현 참고(CGWT+TCN 설계, TLS 연동): ⭐⭐⭐⭐⭐

---

## 7) 논문 작성 활용 메모
- **Related Work 한 줄**  
  > “**CIR 이중채널 DL**(CNN-TCN-Attention + CGWT-CNN)로 LOS/NLOS를 고정밀 분류하고, **통계 보정+TLS**로 실제 랩 환경에서 오차를 **X/Y 1090/645 → 404/239 mm**로 줄였다.”
- **Figure/Table 아이디어**  
  - (Fig) **이중채널+TLS 파이프라인**  
  - (Tbl) 공개/로컬/Mixed **정확도**, 채널별·데이터크기 **아블레이션**

---

## 8) 재현 포인트
- **CIR 절단(650–906 ns)**, **CGWT 파라미터**(복소 가우시안, P=1..8) 고정  
- 채널1 **TCN=6**, 채널2 **Conv=2** 유지 → 과적합 방지  
- **도메인 전이 취약** → 환경별 파인튜닝 또는 **Domain-Adversarial/BN-Adapt** 고려  
- **TLS**는 앵커 좌표 오차까지 포함하므로 실제 배치에서 유리

---

## 9) 구현 체크리스트
- [x] **CIR 전처리**(윈도우링, 정규화)  
- [x] **이중채널 모델**(채널1/채널2, concat 헤드)  
- [x] **분류확률→Rₜ/게이팅/보정** 연동 API  
- [x] **TLS/필터 백엔드 어댑터**  
- [ ] **학습형 거리보정**(규칙→회귀) + **도메인 적응** 실험  
- **우선순위:** 🟢
