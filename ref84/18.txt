# 논문 #18: *Robust TDOA-Based Indoor Localization Using Improved Clock-Sync Scheme and Multilevel Constrained ARPF* (IEEE Sensors Journal, 2023)

## 1) 기본 정보
- **핵심 주제:** 무선 동기화 **TDOA UWB**에서 **시계 동기 정확도·용량**과 **NLOS 강건성**을 동시에 끌어올리는 **개선된 동기화 스킴 + 다중 제약 ARPF(Adaptive Robust Particle Filter)**  
- **키워드:** **Sesqui-way** 동기화, **Kalman 기반 TOA 추정**, **품질정렬 TDOA**, **IGG-III 로버스트 가중**, **Floor-map 접근성 제약**, **멀티레벨 분산 스케일링**

**3줄 요약**
1) **Sesqui-way** 무선 시계 동기(마스터 브로드캐스트 후 **한 개 슬레이브만 응답**)와 **Kalman 기반 TOA 추정**으로 **동기 주기 연장**(채널 점유↓)하면서 정확도 유지.  
2) **신호품질·시간이력·지도** 3계층 **로버스트 팩터**를 관측 분산에 곱해 PF 가중을 동적으로 조정하는 **멀티레벨 ARPF** 제안.  
3) 16×16 m 실내 실제 실험(헬멧/배지/워치 태그)에서 **GPF 대비 상대오차 약 1/2**로 감소, **95% ≤ 1.2 m**, 최악 배지에서도 최대오차를 크게 억제.

**핵심 기여(Contribution)**
- [x] **동기화**: **Sesqui-way** 스킴 + **t_valid** 기반 TOA 결합(예측·보간 하이브리드)로 **동기 빈도↓·지연↔정확도 균형**  
- [x] **관측 최적화**: **품질정렬 TDOA**(수신전력–첫경로전력 차이로 정렬)  
- [x] **강건 PF**: **시간이력 게이트(속도 한계)**, **IGG-III 잔차 로버스트**, **Floor-map 접근성 마스크**를 **분산 스케일러**로 결합

---

## 2) 입력·전처리·매핑
- **TDOA 입력:** 태그 브로드캐스트에 대한 각 앵커 TOA → **품질정렬**로 TDOA 구성  
- **품질 지표:** **P_delta = P_receive − P_firstpath** (DW1000의 CIR 파워·첫경로 F1–F3 활용)  
- **전처리 파이프라인(요약):**  
  1) **Sesqui-way** 동기화 + **Kalman TOA**로 타임스탬프 보정  
  2) 각 앵커의 **P_delta**로 TOA 정렬 → **TDOA_proposed** 계산  
  3) **ΔTDOA 속도 한계** 기반 시간 게이팅  
  4) **IGG-III**로 잔차 기반 로버스트 가중  
  5) **Floor-map 접근성(0/1)** 마스크 반영

**우리 20D와의 매핑**

| 우리 20D 특징 | 본 논문 특징 | 적용 아이디어 |
|---|---|---|
| CIR/SNR/품질 | P_delta로 품질 정량화 | 우리 **CIR/SNR/NLOS score**를 품질정렬·가중에 직결 |
| 지도/가시성 | 접근성 바이너리 | 우리 **레이캐스팅 가시성**으로 접근성 마스크 고도화 |
| PF/EKF | PF 기반 | 우리 **PF↔UKF/FG** 하이브리드에서도 **분산 스케일러** 재사용 |

- **호환성:** ✅ 높음 — 프런트엔드(동기·TDOA)와 백엔드(PF)의 **모듈형 결합** 구조

---

## 3) 모델 아키텍처
- **시계 동기(통신 계층):**  
  - **Sesqui-way**: 매 라운드 **한 슬레이브만** 응답 → **오프셋은 응답 슬레이브에만 정확**, **스큐는 모든 슬레이브에 지속 업데이트**  
  - **TOA 추정:** 이전·다음 동기 쌍 사이에서 **t_valid** 윈도우 내는 **예측**, 이후는 **선형 보간**을 사용해 지연·정확도 균형
- **관측 구성(신호 계층):**  
  - **품질정렬 TDOA**: \(P_\text{delta}\)가 가까운 TOA끼리 차분 → 동일 부호의 바이어스를 상쇄  
- **로버스트 팩터(추정 계층):**  
  - **시간이력 게이트**: \(|\Delta \text{TDOA}_k| \le f_\text{max}(v_\text{human})\) 초과 시 가중 ∞(배제)  
  - **IGG-III**: 잔차 \(|v|\)가 \(c_1, c_2\) 경계 넘으면 **분산 확대** 또는 **배제**  
  - **지도 제약**: 접근성 0 위치에 떨어지는 입자는 **분산∞**(가중=0)  
- **분산 스케일링(핵심 수식):**  
  \[
  \tilde R = \operatorname{diag}\big(R_a R_b R_c \sigma_1^2,\dots, R_a R_b R_c \sigma_n^2\big)
  \]
  → 파티클 가중 \(w \propto \mathcal{N}(z; h(x), \tilde R)\)

**우리 모델과 비교**

| 구성 요소 | 본 논문 | 우리(제안 결합) | 비고 |
|---|---|---|---|
| 동기화 | Sesqui-way + t_valid | 기존 무선 동기에도 적용 가능 | 채널 용량↑ |
| 품질 채널 | \(P_\text{delta}\) | CIR/SNR/FPD/CHN-score | 품질정렬·가중 강화 |
| 백엔드 | ARPF | PF/UKF/FG 공통 **분산 스케일러** | 재사용 용이 |

---

## 4) 학습/설정
- **비학습형**: 파라미터 \(t_\text{valid}\), **IGG-III** 경계 \(c_1 \in [2,3], c_2 \in [4.5,8.5]\), 파티클 수 \(N\)  
- **복잡도:** ARPF \(O(N)\); 품질정렬·지도마스크 추가 오버헤드는 경미

---

## 5) 실험·결과(대표)
- **동기화 벤치마크(복도 10 m, 동기주기 0.5–1.0 s):**  
  - 순수 예측만 쓰면 동기 직후 **200 ms** 이후부터 TDOA 변동이 급격히 증가(1 s에 최대 수 m 수준)  
  - **선형 보간**은 안정적이나 지연 큼  
  - **제안 결합(t_valid=500 ms)**: 데이터의 절반은 실시간 처리, 전체 TDOA 분산은 보간 수준으로 억제 → **동기 주기 연장**과 **채널 점유↓**
- **실내 필드(16×16 m, 앵커 4, 헬멧/배지/워치):**  
  - 비교: **LS / IMMEKF / GPF / ARPF(제안)**  
  - **ARPF 궤적**이 지도 접근 불가 영역을 거의 침범하지 않으며 **가장 GT 근접**  
  - **오차 통계:** **95% ≤ 1.2 m**, 헬멧·워치 **최대오차 < 1.4 m**, 배지(인체차폐 최악)도 **< 2.4 m**  
  - **GPF 대비 상대오차 약 1/2** 수준; **연산시간**은 GPF와 비슷한 오더(추가 정보 처리에도 과도 증가 없음)

---

## 6) 우리 연구와의 관계
- **즉시 적용 포인트**
  1) **품질정렬 TDOA**: 우리 **CIR/SNR/FPD/NLOS score**로 \(P_\text{delta}\) 대체·확장  
  2) **멀티레벨 분산 스케일링**: **시간이력 게이트 + IGG-III + 지도마스크**를 **PF/UKF/FG** 공통 유틸로 모듈화  
  3) **Sesqui-way + Kalman TOA**: 동기 주기 늘리고 태그 동시접속 용량↑(대규모 실험에 유리)
- **벤치마킹 가치**  
  - Related Work: ⭐⭐⭐⭐ / Baseline(로버스트 PF 라인): ⭐⭐⭐⭐⭐ / 구현 참고(무선 동기+품질정렬): ⭐⭐⭐⭐⭐

---

## 7) 논문 작성 활용 메모
- **Related Work 문장 초안**  
  > “무선 TDOA에서 **Sesqui-way 동기 + Kalman TOA**로 채널 점유를 낮추고, **품질·시간이력·지도** 3계층 로버스트 팩터를 결합한 **ARPF**로 **NLOS 강건성**을 확보했다.”
- **Methodology 차용**  
  1) **분산 스케일러 표준화**: \(R\leftarrow R_a R_b R_c R\) 패턴을 전 백엔드에 공통 적용  
  2) **품질정렬 Ablation**: (품질정렬 on/off, 품질채널 종류) × (지도마스크 on/off) × (IGG-III 경계)  
- **Figure/Table 아이디어**  
  - (Fig) **동기 스케줄러** & **t_valid** 시나리오  
  - (Tbl) **LS/IMMEKF/GPF/ARPF** 오차(percentiles)·연산시간 비교

---

## 8) 재현 팁
- **t_valid**는 동기주기의 **~1/2** 근방이 실시간성–안정성 균형에 유리  
- **IGG-III 경계**는 데이터셋별 튜닝(잔차 히스토그램 기반)  
- **지도마스크**는 레이캐스팅 기반 **가시성 0/1**로 빠르게 생성 가능

---

## 9) 구현 체크리스트
- [x] **품질정렬 TDOA 모듈**(CIR/SNR/FPD 입력)  
- [x] **ARPF 분산 스케일러**(시간이력·IGG-III·지도 제약)  
- [x] **Sesqui-way 동기 + Kalman TOA**(t_valid 파라미터화)  
- [ ] **Ablation 스크립트**(품질채널/지도/IGG-III 경계/동기주기 스윕)  
- **우선순위:** 🟢
